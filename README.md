# 双策略波动率风险溢价捕捉系统

## 项目概述

波动率风险溢价捕捉系统是一个基于 Python 开发的量化交易策略框架，通过动态组合期限结构交易策略和ETF对冲策略，实现在不同市场环境下捕捉波动率风险溢价的目标。该系统能够有效识别不同市场状态，并根据市场环境动态调整策略权重，以获取稳健的风险调整后收益。

## 策略原理

波动率风险溢价是指市场参与者愿意支付保险费用以规避未来波动的现象。本系统通过两种互补的策略来捕捉这一风险溢价：

1. **期限结构策略 (Term Structure Strategy)** : 利用 VIX 期货期限结构的变化规律，在不同市场状态下做多或做空波动率。当期限结构处于正向状态 (contango) 时做空波动率，在反向状态 (backwardation) 时做多波动率。
2. **ETF对冲策略 (ETF Hedge Strategy)** : 主要通过做空波动率 ETF (如 VXX) 来捕捉波动率均值回归和期限结构曲线 roll yield 产生的衰减。同时，包含风险管理机制，在市场波动剧烈增加时快速减仓。
3. **等权组合 (Equal Weight Portfolio)** : 简单地将上述两个策略等权重组合，无动态调整。
4. **动态策略选择 (Dynamic Strategy Selection)** : 核心创新点，根据当前市场状态动态调整两个基础策略的权重，在不同市场环境下发挥各策略的优势，规避其劣势。

## 功能特性

* **双策略协同** : 期限结构策略 + ETF 对冲策略动态组合
* **市场状态识别** : 自动识别 6 种市场状态并优化策略权重
* **全面分析** : 提供详细的绩效指标和市场状态分析
* **可视化展示** : 生成直观的策略表现图表
* **样本内外测试** : 支持训练集/测试集分离验证
* **参数化配置** : 所有关键参数均可配置调整

## 市场状态分类

系统基于三个关键指标对市场进行分类：

* **VIX水平** : 市场波动率指标（低于 15 为低波动，高于 25 为高波动）
* **市场趋势** : 价格相对于长期均线的位置
* **期限结构形态** : VIX期货曲线的形态

根据这些指标的组合，系统识别出6种不同的市场状态：

1. **状态1 - 平静上涨** : 低 VIX，上升趋势，正向期限结构（占比 20.7%）
2. **状态2 - 平静整理** : 低/中 VIX，横盘趋势，正向期限结构（占比 40.8%）
3. **状态3 - 轻微压力** : 中等 VIX，下跌趋势，正向/平坦期限结构（占比 14.2%）
4. **状态4 - 明显压力** : 中/高 VIX，下跌趋势，平坦期限结构（占比 15.5%）
5. **状态5 - 恐慌** : 高 VIX，急跌趋势，反向期限结构（占比 0.1%）
6. **状态6 - 恢复** : 高/中 VIX，反弹趋势，反向/平坦期限结构（占比 8.7%）

## 项目结构

```
波动率风险溢价捕捉系统
.src
├── main.py                 # 主程序入口
├── data_fetcher.py         # 增强版数据获取模块
├── market_state.py         # 市场状态分类
├── strategies.py           # 交易策略实现
├── dynamic_selection.py    # 动态策略选择系统
├── performance.py          # 绩效评估
├── visualization.py        # 数据可视化
├── config.py               # 配置文件
└── data_cache/             # 数据缓存目录
```

## 安装与运行

### 安装依赖

```bash
pip install pandas numpy matplotlib seaborn scipy yfinance requests
```

### 运行系统

1. **基本运行**

```bash
python src/main.py
```

2. **自定义回测参数**

```bash
python src/main.py --start_date 2018-01-01 --end_date 2022-12-31 --output_dir custom_results
```

3. **数据获取选项**

```bash
# 强制重新下载数据（不使用缓存）
python src/main.py --force_download

# 不使用任何缓存
python src/main.py --no_cache

# 使用本地数据文件
python src/main.py --local_file path/to/historical_data.csv
```

4. **只运行回测，不生成图表**

```bash
python src/main.py --no_plots
```

5. **使用运行脚本（Linux/Mac）**

```bash
chmod +x run.sh
./run.sh
```

## 策略详解

### 期限结构策略 (Term Structure Strategy)

* **基本原理** : 利用VIX期货期限结构的变化规律和波动率均值回归特性
* **收益特点** : 收益分布呈右偏，日收益均值 0.23%，标准差 4.57%，偏度 1.37
* **优势场景** : 在市场恐慌 (状态 5) 和恢复期 (状态 6) 表现突出，月均收益分别为 0.9%和 13.7%
* **劣势场景** : 在轻微压力 (状态 3) 环境下表现不佳，月均收益为 -2.0%
* **风险特征** : 样本外期间最大回撤为 30.3%，但累积收益显著，波动较大

### ETF对冲策略 (ETF Hedge Strategy)

* **基本原理** : 利用波动率ETF (如 VXX ) 因期限结构曲线 roll yield 产生的长期衰减特性
* **收益特点** : 收益分布呈左偏，日收益均值 0.06%，标准差 3.66%，偏度 -2.09
* **优势场景** : 在平静整理 (状态 2) 和轻微压力 (状态 3) 环境中表现较好，月均收益分别为 4.5%和 4.1%
* **劣势场景** : 在恢复期 (状态 6) 和明显压力 (状态 4) 环境下面临严重风险，尤其在恐慌期 (状态 5) 月均负收益高达 -16.5%
* **风险特征** : 受市场剧烈波动影响显著，样本外期间最大回撤高达 82.6%

### 等权组合 (Equal Weight Portfolio)

* **基本原理** : 简单地将期限结构策略和ETF对冲策略等权重组合
* **收益特点** : 平衡了两种策略的极端表现，日收益均值 0.18%，标准差 2.15%
* **优势** : 整体风险收益比有所改善，样本外夏普比率达到 1.18
* **基准比较** : 作为动态策略选择的基准，平滑了单一策略的波动

### 动态策略选择 (Dynamic Strategy Selection)

* **基本原理** : 根据识别的市场状态动态调整两个基础策略的权重
* **收益特点** : 日收益均值 0.20%，标准差 2.59%，正偏度 0.88
* **优势** : 在各种市场环境下保持相对稳定表现，样本外夏普比率最高达 1.37
* **适应性** : 在不同市场状态下灵活调整权重，如 2020年 COVID-19 期间快速增加期限结构策略权重，有效避免了ETF策略的大幅回撤
* **风险控制** : 样本外期间最大回撤控制在 31.1%，明显优于单一策略

## 策略绩效指标

### 样本内绩效 (2015-2019)

| 指标          | 期限结构策略 | ETF对冲策略 | 等权组合 | 动态组合策略 |
| ------------- | ------------ | ----------- | -------- | ------------ |
| 年化收益(%)   | 21.1         | -2.3        | 50.7     | 16.4         |
| 年化波动率(%) | 77.0         | 49.7        | 31.2     | 25.7         |
| 夏普比率      | 0.59         | 0.17        | 1.40     | 0.64         |
| 最大回撤(%)   | -49.2        | -45.9       | -16.4    | -17.8        |
| 胜率(%)       | 47.7         | 54.8        | 51.4     | 54.3         |

### 样本外绩效 (2020-2023)

| 指标          | 期限结构策略 | ETF对冲策略 | 等权组合 | 动态组合策略 |
| ------------- | ------------ | ----------- | -------- | ------------ |
| 年化收益(%)   | 59.7         | -1.3        | 45.2     | 73.6         |
| 年化波动率(%) | 66.8         | 61.8        | 35.4     | 46.7         |
| 夏普比率      | 1.00         | 0.28        | 1.18     | 1.37         |
| 最大回撤(%)   | -30.3        | -82.6       | -31.4    | -31.1        |
| 胜率(%)       | 50.9         | 57.6        | 55.4     | 57.5         |

### 市场状态分析 (策略月收益率)

| 市场状态         | 占比(%) | 期限结构策略(月) | ETF对冲策略(月) | 等权组合(月) | 动态组合策略(月) |
| ---------------- | ------- | ---------------- | --------------- | ------------ | ---------------- |
| 状态1 (平静上涨) | 20.7    | 11.4%            | 0.5%            | 8.1%         | 3.5%             |
| 状态2 (平静整理) | 40.8    | 2.3%             | 4.5%            | 3.5%         | 3.5%             |
| 状态3 (轻微压力) | 14.2    | -2.0%            | 4.1%            | 1.0%         | 1.0%             |
| 状态4 (明显压力) | 15.5    | 3.3%             | -0.6%           | 2.5%         | 2.5%             |
| 状态5 (恐慌)     | 0.1     | 0.9%             | -16.5%          | 8.7%         | 6.2%             |
| 状态6 (恢复)     | 8.7     | 13.7%            | -4.9%           | 4.0%         | 13.7%            |

## COVID-19危机案例分析

COVID-19 危机期间 (2020年2月-3月) 各策略表现对比:

* **期限结构策略** : 危机期间表现极为出色，收益率逆势大幅上涨超过 150%
* **ETF对冲策略** : 遭受严重打击，损失约 80%的价值
* **等权组合** : 两种策略互相抵消，表现基本平稳
* **动态策略选择** : 在危机初期迅速调整权重，将ETF策略权重降至最低，保持正收益

恢复期 (2020年3月-5月) 表现:

* **期限结构策略** : 继续上涨，有小幅回撤
* **ETF对冲策略** : 开始触底反弹
* **动态策略选择** : 表现优于等权组合，有效捕捉期限结构策略的收益

## 增强版数据获取系统

我们的系统实现了一个健壮的数据获取模块，具有以下特点：

* **智能缓存机制** ：自动缓存已下载数据，避免重复请求
* **多级重试策略** ：使用指数退避算法应对网络错误，提高数据获取成功率
* **备用数据源** ：当主数据源失败时，自动切换到备用数据源
* **合成数据生成** ：在极端情况下，可生成合成数据用于测试
* **全面错误处理** ：详细的日志记录和异常处理

## 系统优势分析

1. **互补性策略组合** : 期限结构策略在高波动环境中表现出色，ETF 对冲策略在低波动环境下更有优势，两者结合能够应对不同市场环境。
2. **动态权重调整** : 根据市场状态图表可见，系统在 2020年 COVID-19 危机期间迅速增加了期限结构策略的权重，避免了 ETF 策略的巨大回撤。
3. **样本外表现优异** : 动态策略选择在 2020-2023年 样本外测试中表现出色，年化收益率达 73.6%，夏普比率 1.37，明显优于其他策略。
4. **风险控制** : 虽然期限结构策略的累积收益更高，但其波动率也明显更大 (66.8%)，而动态策略既保持了较高收益又控制了风险。
5. **智能择时** : 市场状态分类显示，系统成功识别了各种市场环境，包括2020年3月的极端恐慌期（状态 5），并在状态6（恢复期）中捕捉到了高达 13.7% 的月均收益。

## 注意事项

1. 本系统中VIX期货数据为基于VIX和VXX合成的模拟数据，实际应用中应使用真实的期货数据。
2. 回测结果显示，ETF 对冲策略在样本外测试中经历了高达 82.6% 的最大回撤，实际应用需谨慎。
3. 期限结构策略虽然表现亮眼，但波动性较大（年化波动率 66.8%），实际应用中应考虑降低杠杆和增强风险管理机制。
4. 市场状态分类中，恐慌状态（状态 5）在回测期间出现频率很低（仅占 0.1%），样本量较小可能影响结果可靠性。

## 拓展方向

1. **机器学习增强** ：引入机器学习方法优化市场状态识别和预测
2. **期权波动率曲面** ：纳入期权波动率曲面信息，增加策略维度
3. **精细风险管理** ：特别针对 ETF 对冲策略开发更精细的风险管理机制
4. **多资产整合** ：探索波动率策略与其他资产类别的组合效应

## 技术支持

遇到问题时请提供:

1. `log/backtest.log`日志文件
2. 使用的参数配置
3. 问题重现步骤

更多详细信息请参考项目文档或联系我：`Jacky 2354889815@qq.com`

## 版权声明

© 2025 Jacky。保留所有权利。
本项目采用MIT许可证授权，详情请见项目根目录下的  `LICENSE` 文件。
